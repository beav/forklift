---
- name: 'Update packages'
  yum:
    name: '*'
    update_cache: yes
    state: latest

- name: 'Install foreman-release-scl'
  yum:
    name: foreman-release-scl
    update_cache: yes
    state: latest

- name: 'Install Katello RPM'
  yum:
    name: katello
    state: latest

# FIXME: Remove when parser cache is available in RPM package
- name: "Install puppetlabs-strings for puppet 4"
  command: "/opt/puppetlabs/bin/puppet module install puppetlabs-strings"
  when: common_puppet_version is defined and common_puppet_version == 4

# FIXME: Remove when parser cache is available in RPM package
- name: "Install yard gem for puppet 4"
  command: "/opt/puppetlabs/puppet/bin/gem install yard"
  when: common_puppet_version is defined and common_puppet_version == 4

- name: 'Run installer'
  command: "{{ katello_installer_command }}"
  when: not katello_skip_installer
